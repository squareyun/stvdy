import{X as I,x as l,C,o as c,c as d,d as n,V as w,Z as k,v as D,t as S,a as N,F as P,q,$ as K,b as Q}from"./index-f0d74d49.js";import{_ as x,l as W}from"./UserVideo-92a064f6.js";import"./_commonjsHelpers-de833af9.js";const Y={id:"main-container"},ee={key:0,id:"join"},ne=n("div",{id:"img-div"},null,-1),te={id:"join-dialog"},ae=n("h1",null,"Join a video session",-1),oe=n("label",null,"Participant",-1),ie=n("label",null,"Session",-1),se={key:1,id:"session"},le={id:"session-header"},re={id:"session-title"},ue={id:"main-video"},ce={id:"video-container"},de={id:"chat-container"},ve={id:"chat-window"},me={id:"chat-history"},pe={id:"chat-write"},fe=n("option",{disabled:""},"사용할 카메라를 선택하세요",-1),he=[fe],ge=n("option",{disabled:""},"사용할 마이크를 선택하세요",-1),_e=[ge],ke={__name:"RoomView",setup(ye){I.defaults.headers.post["Content-Type"]="application/json";const B="",g=l(void 0),o=l(void 0);let v=l(void 0);const i=l(void 0),m=l([]),_=l("SessionCrome"),y=l("Participant"+Math.floor(Math.random()*100)),p=l(""),T=l([]),f=l(!1),h=l(!1),V=l(""),M=l(""),L=C(()=>v.value),U=C(()=>i.value),O=C(()=>m.value);function R(){g.value=new W.OpenVidu,o.value=g.value.initSession(),o.value.on("streamCreated",({stream:e})=>{const t=o.value.subscribe(e);m.value.push(t)}),o.value.on("streamDestroyed",({stream:e})=>{const t=m.value.indexOf(e.streamManager,0);t>=0&&m.value.splice(t,1)}),o.value.on("exception",({exception:e})=>{console.warn(e)}),o.value.on("signal:chat",e=>{const t=JSON.parse(e.data);e.from.connectionId===o.value.connection.connectionId&&(t.username="나"),T.value.push(t)}),j(_.value).then(e=>{o.value.connect(e,{clientData:y.value}).then(()=>{let t=g.value.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!f.value,publishVideo:!h.value,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});v.value=t,i.value=t,o.value.publish(i.value),$()}).catch(t=>{console.log("There was an error connecting to the session:",t.code,t.message)})}),window.addEventListener("beforeunload",b)}function b(){o.value&&o.value.disconnect(),o.value=void 0,v.value=void 0,i.value=void 0,m.value=[],g.value=void 0,window.removeEventListener("beforeunload",b)}function E(e){v.value!==e&&(v.value=e)}async function j(e){return(await I.post(B+"rooms/add",{userNo:53,title:e,endHour:1,endMinute:30,quota:16,isPrivacy:!1,password:"1234",iamgePath:"imgURL",rule:"rule Text which is veruy long"},{headers:{"Content-Type":"application/json"}})).data}function J(e){e.preventDefault(),p.value.trim()&&(o.value.signal({data:JSON.stringify({username:y.value,message:p.value}),type:"chat"}),p.value="")}async function $(){try{const e=await navigator.mediaDevices.enumerateDevices(),t=e.filter(s=>s.kind==="videoinput"),a=e.filter(s=>s.kind==="audioinput"),r=document.querySelector('select[name="cameras"]'),A=document.querySelector('select[name="audios"]');if(t)t.forEach(s=>{const u=document.createElement("option");u.value=s.deviceId,u.text=s.label,r.appendChild(u)});else{const s=r.querySelector("option:disabled");s.innerText="사용 가능한 카메라가 없습니다."}if(a)a.forEach(s=>{const u=document.createElement("option");u.value=s.deviceId,u.text=s.label,A.appendChild(u)});else{const s=A.querySelector("option:disabled");s.innerText="사용 가능한 마이크가 없습니다."}}catch(e){console.error("Error getting media devices:",e)}}function F(){if(!i.value)return;h.value=!h.value;const e=document.getElementById("camera-activate");h.value?e.innerText="카메라 활성화":e.innerText="카메라 비활성화",i.value.publishVideo(!h.value)}function H(){if(!i.value)return;f.value=!f.value;const e=document.getElementById("mute-activate");f.value?e.innerText="음소거 비활성화":e.innerText="음소거 활성화",i.value.publishAudio(!f.value)}async function X(e){V.value=e.target.value,await z(V.value)}async function Z(e){M.value=e.target.value,await G(M.value)}async function z(e){if(!i.value)return;const t={audio:!1,video:{deviceId:{exact:e}}};try{const r=(await navigator.mediaDevices.getUserMedia(t)).getVideoTracks()[0];await i.value.replaceTrack(r)}catch(a){console.error("Error replacing video track:",a)}}async function G(e){if(!i.value)return;const t={audio:{deviceId:{exact:e}},video:!1};try{const r=(await navigator.mediaDevices.getUserMedia(t)).getAudioTracks()[0];await i.value.replaceTrack(r)}catch(a){console.error("Error replacing audio track:",a)}}return(e,t)=>(c(),d("div",Y,[o.value?D("",!0):(c(),d("div",ee,[ne,n("div",te,[ae,n("div",null,[n("p",null,[oe,w(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),type:"text",required:""},null,512),[[k,y.value]])]),n("p",null,[ie,w(n("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),type:"text",required:""},null,512),[[k,_.value]])]),n("p",null,[n("button",{onClick:R},"Join!")])])])])),o.value?(c(),d("div",se,[n("div",le,[n("h1",re,S(_.value),1),n("input",{type:"button",id:"buttonLeaveSession",onClick:b,value:"Leave session"})]),n("div",ue,[N(x,{"stream-manager":L.value},null,8,["stream-manager"])]),n("div",ce,[N(x,{"stream-manager":U.value,onClick:t[2]||(t[2]=a=>E(i.value))},null,8,["stream-manager"]),(c(!0),d(P,null,q(O.value,a=>(c(),K(x,{key:a.stream.connection.connectionId,"stream-manager":a,onClick:r=>E(a)},null,8,["stream-manager","onClick"]))),128))]),n("div",de,[n("div",ve,[n("ul",me,[(c(!0),d(P,null,q(T.value,(a,r)=>(c(),d("li",{key:r},[n("strong",null,S(a.username)+":",1),Q(" "+S(a.message),1)]))),128))])]),n("form",pe,[w(n("input",{type:"text",placeholder:"전달할 내용을 입력하세요.","onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a)},null,512),[[k,p.value]]),n("button",{onClick:J},"전송")])]),n("button",{id:"camera-activate",onClick:F}," 캠 비활성화 "),n("button",{id:"mute-activate",onClick:H}," 음소거 활성화 "),n("div",null,[n("select",{name:"cameras",onChange:X},he,32),n("select",{name:"audios",onChange:Z},_e,32)])])):D("",!0)]))}};export{ke as default};
